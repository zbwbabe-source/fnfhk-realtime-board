# 2월 15일 vs 2월 16일 매출 데이터 검증 보고서

**작성일**: 2026-02-17  
**검증자**: AI Assistant

---

## 📋 요약

사용자 질문: "2월 16일 매출이 2월 15일과 같은데 진짜 데이터가 0임?"

**결론**: ❌ **아니오. 2월 16일 데이터는 정상적으로 존재합니다.**

---

## 🔍 검증 결과

### 1. 일별 총 매출 데이터 (전체 매장)

| 날짜 | 매장 수 | 레코드 수 | 총 매출 | 총 정가 |
|------|--------|----------|---------|---------|
| 2025-02-15 | 42개 | 1,852건 | 2,436,244원 | 3,012,430원 |
| 2025-02-16 | 42개 | 1,895건 | 2,164,268원 | 2,728,900원 |

### 2. MTD (월누계) 비교

#### HKMC M 브랜드
- **2월 15일**: MTD 11,130,518원 | YTD 47,864,207원
- **2월 16일**: MTD 11,769,207원 (+638,689원) | YTD 48,502,896원
- **YoY**: 46.57% → 46.98%

#### TW M 브랜드  
- **2월 15일**: MTD 28,509,311원 | YTD 103,367,235원
- **2월 16일**: MTD 29,968,416원 (+1,459,105원) | YTD 104,826,340원
- **YoY**: 71.05% → 69.32%

#### TW X 브랜드
- **2월 15일**: MTD 1,458,937원 | YTD 9,006,787원
- **2월 16일**: MTD 1,525,410원 (+66,473원) | YTD 9,073,260원

### 3. 2월 MTD 전체 합계

| 기간 | 총 매출 |
|------|---------|
| 2월 1일 ~ 2월 15일 | 41,098,766원 |
| 2월 1일 ~ 2월 16일 | 43,263,033원 |
| **2월 16일 매출** | **2,164,268원** |

---

## ✅ 데이터 검증 확인 사항

1. ✅ Snowflake 데이터베이스에 2월 16일 데이터 존재
2. ✅ 42개 매장 모두 2월 16일 데이터 보유 (매출 0인 매장 없음)
3. ✅ MTD 금액이 2월 15일 대비 정상적으로 증가
4. ✅ YTD 금액도 함께 증가
5. ✅ 레코드 수도 1,852건 → 1,895건으로 증가

---

## ❌ Redis 캐시 상태

**검증 일시**: 2026-02-17 08:06 AM

다음 캐시 키들이 **모두 비어있음**:
- `snapshot:SECTION1:store-sales:HKMC:M:2025-02-15` ❌
- `snapshot:SECTION1:store-sales:HKMC:M:2025-02-16` ❌
- `snapshot:SECTION1:store-sales:TW:M:2025-02-15` ❌
- `snapshot:SECTION1:store-sales:TW:M:2025-02-16` ❌
- 기타 모든 Section1 캐시 키 비어있음

→ **캐시가 비어있으므로 모든 요청은 Snowflake에서 직접 조회됨**

---

## 🔧 문제 원인 분석

### 가능한 원인들:

1. **대시보드 날짜 선택 문제**
   - 사용자가 대시보드에서 날짜를 2025-02-16으로 변경하지 않았을 가능성
   - DatePicker UI가 올바르게 작동하지 않았을 가능성

2. **브라우저 캐시**
   - 브라우저가 이전 응답을 캐시하고 있을 가능성
   - 하드 리프레시(Ctrl + F5) 필요

3. **Latest Date API 문제**
   - `/api/latest-date` API가 오래된 날짜를 반환
   - 대시보드가 최신 날짜를 자동으로 선택하지 못함

4. **타임존 이슈**
   - 서버 시간대와 클라이언트 시간대 불일치
   - 데이터 조회 시 날짜 형식 변환 문제

---

## 💡 권장 조치 사항

### 즉시 조치:
1. **브라우저 새로고침**: Ctrl + F5 (하드 리프레시)
2. **날짜 수동 선택**: 대시보드에서 2025-02-16 직접 선택
3. **브라우저 캐시 삭제**: 개발자 도구 → Application → Clear Storage

### 확인 방법:
API를 직접 호출하여 데이터 확인:
```bash
# HKMC M 브랜드 2월 16일 데이터
GET https://your-domain.com/api/section1/store-sales?region=HKMC&brand=M&date=2025-02-16

# TW M 브랜드 2월 16일 데이터  
GET https://your-domain.com/api/section1/store-sales?region=TW&brand=M&date=2025-02-16
```

### 근본 원인 조사:
1. 브라우저 개발자 도구 Network 탭에서 API 요청 확인
2. 요청 URL의 `date` 파라미터가 `2025-02-16`인지 확인
3. 응답 데이터의 `asof_date` 필드 확인
4. `/api/latest-date` API 응답 확인

---

## 📊 검증 스크립트

다음 스크립트들이 생성되었습니다:

1. **check-feb-sales.ts**: 2월 15일/16일 일별 데이터 비교
   ```bash
   npx ts-node scripts/check-feb-sales.ts
   ```

2. **compare-mtd.ts**: MTD 상세 비교 (Section1 쿼리 기준)
   ```bash
   npx ts-node scripts/compare-mtd.ts
   ```

3. **check-redis-cache.ts**: Redis 캐시 상태 확인
   ```bash
   npx ts-node scripts/check-redis-cache.ts
   ```

---

## 📝 추가 참고 사항

- 최신 데이터 날짜: 2026-02-16 (381일치 2월 데이터 존재)
- 데이터베이스: SAP_FNF.DW_HMD_SALE_D
- 전체 매장: HKMC 29개 + TW 13개 = 42개
- 모든 매장에서 2월 16일 데이터 정상 확인

---

**결론**: 2월 16일 매출 데이터는 **정상적으로 존재**하며, Snowflake에서 올바르게 조회됩니다. 대시보드에서 동일하게 보인다면 **캐시나 UI 문제**입니다.
